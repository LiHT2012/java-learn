== 权限自动处理脚本

*作者：* 宋鹏程

*日期：* 2017/9/6

*摘要：* 该文档定义了一种权限自动处理脚本，可以用于自动处理权限数据。

权限数据在后台储存为一个data，为了实现诸如创建时添加创建者至特定权限， 批量刷新库下所有条目的权限等操作， 我们在这里定义了一种自动处理权限的脚本语言，用于更方便的批量处理权限数据。

=== 可操作元素

* permission: 权限数据，我们需要修改的权限data

* input: 作为操作的输入，定义为一个包含若干用户或群组的id的数组, 可以为空。

* stack: 临时储存栈，用于储存从input，或者data读取的id

* pointer: 游标指针，指向当前操作的权限fid

* mover: 当前命令的位置

=== 可用操作

* > : 从input中pop一个值， push入stack中， 如果数据为空，不操作。

* < : 从stack中pop一个值， push入当前pointer所指的权限数据中， 如果数据为空，不操作。

* =key : 设置当前pointer 为 key， 如果key不是一个有效值， 不操作。

* ! : 清空当前pointer所指位置的所有权限。

* * : 从当前pointer所指的数据中 pop 一个值， push入stack中，如果数据为空，不操作。

* ( : 如果当前stack为空， mover直接跳到对应 ) 后一个指令， 否则执行下一个指令。

* ) : 如果当前stack不为空， mover直接跳到对应的 ( 后一个指令， 否则执行下一个指令。

* [ : 如果当前pointer所指的数据为空， mover直接跳到对应 ] 后一个指令， 否则执行下一个指令。

* ] : 如果当前pointer所指的数据不为空， mover直接跳到对应的 [ 后一个指令， 否则执行下一个指令。

* + : 复制stack顶部的值

* - : 一次pop出stack顶部的两个值，如果相同， push回任意一个， 否则按顺序push回两个值 （此时顶部两个id顺序会发生变化）

=== 数据类型

* id : 所有的 id 均为24位 只包含数字和字母的字符串

* key: 1-28 的正整数

=== 示例

==== 设置创建者到编辑权限

[source, javascript]
----
{
    input: "createrid",
    script: "=11>[*-](<)"
}
----

==== 将某id从编辑权限中删除

[source, javascript]
----
{
    input: "idtoberemoved",
    script: "=11>[*-]<!(<)"
}
----

==== 将某id从编辑权限移动到管理员

[source, javascript]
----
{
    input: "idtobemoved",
    script: "=11>[*-]=21<=11(<)"
}
----
